<!doctype html>
<html>
<head>
    <title><%=artist.artistName%> - Musicoin</title>
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/profile/profile.css">
    <style>
        body        { word-wrap:break-word; }
        .profile-image {
            justify-content: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .social-group {
            display: flex;
            flex-direction: column;
        }
        input.form-control  {
            width: 230px;
        }
        .track-container {
            background-color: rgba(0,0,0,0.05);
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
            display: flex;
        }
        .flex-row {
            display: flex;
            flex-direction: row;
        }
        .stat {
            margin-right: 20px;
        }
        .track-title {
            font-size: 24px;
        }
        .player {
            background-color: #333;
            height: 125px;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
        }

        #player-fill {
            height: 125px;
            width: 100%;
        }

        .player-foreground {
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-direction: column;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            z-index: 2;
        }

        .player-bookend {
            height: 100%;
            width: 250px;
        }

        .song-badge {
            display: flex;
            align-items: center;
        }

        .player-action-area {
            display: flex;
            flex-direction: row;
            color: white;
            font-size: 14pt;
            height: 100%;
            justify-content: flex-end;
        }

        .song-badge-info {
            display: flex;
            flex-direction: column;
            margin: 10px;
        }

        .song-badge-image {
            max-width: 64px;
            height: 64px;
            object-fit: contain;
        }

        .player-song-name {
            color: white;
            font-size: 18pt;
        }

        .player-artist-name {
            color: white;
        }

        .player-controls {
            display: flex;
            justify-content: center;
            align-items: baseline;
        }

        .player-progress {
            position: relative;
            height: 10px;
        }

        .progress-bar {
            position: absolute;
            left: 0;
            height: 4px;
            border-radius: 5px!important;
        }

        .progress-background {
            right: 0;
            width: 100%;
            background-color: rgba(255,255,255,0.2);
        }

        .progress-foreground {
            width: 0%;
            background-color: white;
        }

        @media screen and (max-width: 500px) {
            .big-screen-only {
                display: none !important;
            }

            .player-controls {
                justify-content: flex-end;
            }
        }

        .player-controls-area {
            height: 100%;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .player-background {
            position: absolute;
            top:0;
            left:0;
            bottom:0;
            right: 0;
            background-size: cover;
            filter:blur(45px);
            overflow: hidden;
            opacity: 0.2;
            z-index: 1;
        }


        .play-controls-container {
            display: flex;
            justify-content: space-between;
        }

        .player-control:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .player-control {
            border-radius: 50%!important;
            width: 36px;
            height: 36px;
            margin-left: 10px;
            margin-right: 10px;
            cursor: pointer;
        }

        .player-control-large {
            width: 48px;
            height: 48px;
        }

        .player-action-values {
            margin-right: 5px;
            text-align: right;
        }

        .player-time-area {
            display: flex;
            justify-content: space-between;
            color: white;
        }

        .player-row {
            min-width: 300px;
            width: 95%;
            max-width: 800px;

        }

        .player-top-row {
            display: flex;
            flex-direction: row;
            align-items: center;
        }

        .player-progress-row {
            display: flex;
            flex-direction: column;
        }

        .show-on-play {
            display: none;
        }

        .selected-track {
            background-color: rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
<div class="container">

    <div class="page-header text-center">
        <h1><%=artist.artistName%></h1>
        <!--<a href="/logout" class="btn btn-default btn-sm">Logout</a>-->
    </div>

    <div>
        <div class="col-sm-6">
            <div class="well">
                <div class="profile-image">
                    <img id="profileImage" style="min-width: 64px; min-height: 64px; width: 256px; max-height:256px; object-fit: contain"  src="<%=artist.image%>">
                </div>
                <div class="form-group">
                    <div name="description"><%= artist.description %></div>
                </div>
                <div class="form-group">
                    <label>Social</label>
                    <div>
                    <%
                    var socialTypes = [
                        {id: "google", icon: "fa-google-plus"},
                        "facebook", "twitter",
                        {id: "soundcloud", name: "sound cloud"}, "linkedin", "youtube",
                        {id: "reverbnation", icon: "fa-star", name: "reverb nation"},
                        "pinterest", "instagram", "medium"
                    ]
                    for (var i = 0; i < socialTypes.length; i++) {
                        var item = socialTypes[i];
                        if (typeof item == "string") {
                            item = {id: item};
                        }
                        var value = artist && artist.social ? artist.social[item.id] : "";
                        var name = item.name ? item.name : item.id;
                        var icon = item.icon ? item.icon : "fa-" + item.id;
                    if (value) { %>
                    <a href="<%=value%>" target="_blank" class="fa <%= icon %>"></a>
                    <% }
                    }
                    %>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <% if (artist.releases.length > 0) {%>
        <div class="col-sm-6">
            <div class="well">
                <h3 class="text-success"><span class="fa fa-music"></span> Releases</h3>
                <% for (var i=0; i < artist.releases.length; i++) {
                    var release = artist.releases[i];
                %>
                <div class="track-container flex-row" onclick="playItem(event, '<%=release.audioUrl%>', '<%=release.title%>', '<%=artist.artistName%>', '<%=release.image%>', '<%=release.playCount%>', '<%=release.tipCount%>')">
                    <img width="64" height="64" src="<%=release.image%>">
                    <div style="margin-left: 10px">
                        <div class="track-title"><%=release.title%></div>
                        <div class="flex-row">
                            <label class="stat">Tips <%=release.tipCount%></label>
                            <label class="stat">Plays <%=release.playCount%></label>
                        </div>
                    </div>

                </div>
                <%}%>
            </div>
        </div>
        <%}%>
    </div>

    <div id="player-fill" class="show-on-play"></div>
    <div id="player-section" class="fixed-footer player show-on-play">
        <div class="player-foreground">
            <div class="player-row player-top-row">
                <div class="song-badge player-bookend">
                    <img id="player-badge-image" src="" class="song-badge-image">
                    <div class="song-badge-info">
                        <div id="player-title" class="player-song-name"></div>
                        <div id="player-artist" class="player-artist-name"></div>
                    </div>
                </div>
                <div class="player-controls-area">
                    <div class="player-controls">
                        <img id="player-play-button" onclick="togglePlayState()" src="/images/player/play.png" class="player-control player-control-large">
                    </div>
                </div>
                <div class="player-action-area player-bookend big-screen-only">
                    <div class="player-action-values">
                        <div id="player-plays"></div>
                        <div id="player-tips"></div>
                    </div>
                    <div class="player-action-names">
                        <div>plays</div>
                        <div>tips</div>
                    </div>
                </div>
            </div>
            <div class="player-row player-progress-row">
                <div class="player-progress">
                    <div class="progress-bar progress-background"></div>
                    <div id="player-progress-div" class="progress-bar progress-foreground"></div>
                </div>
                <div class="player-time-area">
                    <div id="player-time-played"></div>
                    <div id="player-time-left"></div>
                </div>
            </div>
        </div>
        <div id="player-background" class="player-background" style="background-image: url('')"></div>
    </div>

</div>
<audio autoplay id="player"></audio>
</body>
<script src="/js/jquery-3.1.1.js"></script>
<script>
  $( document ).ready(function() {
    getAudioPlayer();
  });

  var previous = null;
  function playItem(event, url, title, artist, img, playCount, tipCount) {
    var e = event.currentTarget;
    if (e) {
      if (previous) previous.classList.remove("selected-track")
      previous = e;
      e.classList.add("selected-track");
    }
    $(".show-on-play").css("display", "block");
    $("#player-title")[0].innerHTML = title;
    $("#player-artist")[0].innerHTML = artist;
    $("#player")[0].src = url + "?" + new Date().getTime();
    $("#player-background")[0].style.backgroundImage = "url('" + img + "')";
    $("#player-badge-image")[0].src = img;
    $("#player-plays")[0].innerHTML = playCount;
    $("#player-tips")[0].innerHTML = tipCount;
  }

  var audioPlayer = null;
  function getAudioPlayer() {
    if (!audioPlayer) {
      audioPlayer = $('#player')[0];
      audioPlayer.style.display = "block";
      audioPlayer.addEventListener('timeupdate', function() {
        var progress_percent = audioPlayer.currentTime / audioPlayer.duration * 100;
        $("#player-progress-div").css("width", progress_percent + "%");
        $("#player-time-played")[0].innerText = formatTime(audioPlayer.currentTime);
        $("#player-time-left")[0].innerText = formatTime(audioPlayer.duration);
      });

      audioPlayer.addEventListener('play', function() {
        $("#player-play-button")[0].src = "/images/player/pause.png";
      })

      audioPlayer.addEventListener('pause', function() {
        $("#player-play-button")[0].src = "/images/player/play.png";
      })
    }
    return audioPlayer;
  }

  function formatTime(seconds) {
    var output = new Date(seconds * 1000).toISOString().substr(11, 8);
    if (output.startsWith("00:")) return output.substr(3);
    return output;
  };

  function togglePlayState() {
    var player = getAudioPlayer();
    if (player.paused) {
      if (player.readyState > 0) {
        player.play();
      }
    }
    else {
      player.pause();
    }
  }
</script>
</html>